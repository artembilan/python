# CloudFoundry Deployment
:imagesdir: ../images
:java-python-buildpack:  https://github.com/dturanski/java-python-buildpack
:python-buildpack: https://github.com/cloudfoundry/python-buildpack
:java-buildpack: https://github.com/cloudfoundry/python-buildpack
:python-springcloudstream: https://pypi.python.org/pypi/springcloudstream

## Java Python Buildpack

The {java-python-buildpack}[Java Python Buildpack] is design specifically for hybrid Java and Python apps in which the
container requires both Java and Python runtime environments. In this context, the buildpack supports the packaging
of a Spring Cloud Stream Python application (jar) which provides the messaging infrastructure, health check, and
scaffolding  to delegate all message processing to an external Python application. The Python application can
be anything that the standard CloudFoundry {python-buildpack}[Python buildpack] supports. Python developers will find
this easy use. Simply include the appropriate Spring Cloud Stream Python app (The python local processor compiled
for the desired messaging middleware) along with your app, deploy it with the Java Python buildpack.

## Application Layout

Download the appropriate Spring Cloud Stream Python app executable jar (e.g., prepackaged with a Rabbit or Kafka
Binder) in the root directory of your Python app. You can `cf push` the app as you would a normal Python app,
specifying the {java-python-buildpack}[Java Python buildpack].

If you are deploying with Spring Cloud Data Flow, you need to zip up your app directory along with the jar. The
buildpack will take care of the rest, providing the full functionality of the Python buildpack, along with a specialized Java buildpack component.

Note that you should not provide a Procfile or startup script.  The Java app will take care of starting the
Python process. This is necessary since it establishes a tcp I/O pipe to deliver message payloads and receive the reply.

Minimally, the Java Python buildpack will install your Python (or Jython script(s)) in the root app directory.
If there is no `requirements.txt`, `environment.yml` or `setup.py` as required by the {python-buildpack}[Python buildpack],
the Python buildpack will not be invoked, but the Java Python buildpack is still required to correctly handle this
layout.

### Example

Suppose you have start with a simple ap in a directory containing:

```
myapp.py
requirements.txt
```
You download `python-local-processor-rabbit-1.2.1.BUILD-SNAPSHOT.jar` 

```
$ wget https://github.com/dturanski/spring-cloud-stream-binaries/blob/master/binaries/python-local-processor-rabbit-1.2.1.BUILD-SNAPSHOT.jar?raw=true -O python-local-processor-rabbit-1.2.1.BUILD-SNAPSHOT.jar
```
Or eventually from the Spring IO Maven repo.


Next,

```
$ cf push -b  https://github.com/dturanski/java-python-buildpack
```

Or for use with Spring Cloud Data Flow Cloud Foundry Server, zip the directory 
```
$ zip ../myapp.zip -r *
```
and register the zip file as processor. You must also specify the {java-python-buildpack}[Java Python buildpack] as a deployment property. For example:

```
dataflow:>stream deploy my-stream --properties "deployer.myapp.cloudfoundry.buildpack=https://github.com/dturanski/java-python-buildpack"
```

{nbsp} +

image::packaging-python-stream-apps.png[Packaging]

